{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/home/jackson/www/github/simulador_plm/src/context/files.tsx\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { useState, createContext, useEffect, useCallback, useContext } from 'react';\nimport axios from 'axios';\nimport { v4 as uuidv4 } from 'uuid';\nimport filesize from 'filesize';\nconst FileContext = /*#__PURE__*/createContext({});\nexport const FileProvider = ({\n  children\n}) => {\n  const {\n    0: uploadedFiles,\n    1: setUploadedFiles\n  } = useState([]);\n  useEffect(() => {\n    axios.get('/api/upload/').then(response => {\n      const postFormatted = [];\n      postFormatted.push({\n        id: response.data._id,\n        name: response.data.name,\n        readableSize: filesize(response.data.size),\n        uploaded: true,\n        preview: response.data.url,\n        file: null,\n        error: false,\n        url: response.data.url\n      });\n      setUploadedFiles(postFormatted);\n    });\n  }, []);\n  const updateFile = useCallback((id, data) => {\n    setUploadedFiles(state => state.map(file => file.id === id ? _objectSpread(_objectSpread({}, file), data) : file));\n  }, []);\n  const processUpload = useCallback(uploadedFile => {\n    const data = new FormData();\n\n    if (uploadedFile.file) {\n      data.append('image', uploadedFile.file, uploadedFile.name);\n      axios.post('/api/upload/', data, {\n        headers: {\n          'content-type': 'multipart/form-data'\n        },\n        onUploadProgress: progressEvent => {\n          const progress = Math.round(progressEvent.loaded * 100 / progressEvent.total);\n          console.log(`A imagem ${uploadedFile.name} está ${progress}% carregada... `);\n          updateFile(uploadedFile.id, {\n            progress\n          });\n        }\n      }).then(response => {\n        console.log(`A imagem ${uploadedFile.name} já foi enviada para o servidor!`);\n        updateFile(uploadedFile.id, {\n          uploaded: true,\n          id: uploadedFile.id,\n          preview: response.data.url,\n          url: response.data.url\n        });\n      }).catch(err => {\n        console.error(`Houve um problema para fazer upload da imagem ${uploadedFile.name}`);\n        console.log(err);\n        updateFile(uploadedFile.id, {\n          error: true\n        });\n      });\n    }\n  }, [updateFile]);\n  const handleUpload = useCallback(files => {\n    const newUploadedFiles = files.map(file => ({\n      file,\n      id: uuidv4(),\n      name: file.name,\n      readableSize: filesize(file.size),\n      preview: `/uploads/${file.name}`,\n      progress: 0,\n      uploaded: false,\n      error: false,\n      url: `/uploads/${file.name}`\n    }));\n    setUploadedFiles(state => state.concat(newUploadedFiles));\n    newUploadedFiles.forEach(processUpload);\n  }, [processUpload]);\n  const deleteFile = useCallback(name => {\n    axios.delete(`api/upload/?fileName=${name}`);\n    setUploadedFiles(state => state.filter(file => file.name !== name));\n  }, []);\n  return /*#__PURE__*/_jsxDEV(FileContext.Provider, {\n    value: {\n      uploadedFiles,\n      deleteFile,\n      handleUpload\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 144,\n    columnNumber: 3\n  }, this);\n};\nexport const useFiles = () => {\n  const context = useContext(FileContext);\n\n  if (!context) {\n    throw new Error('useFiles must be used within FileProvider');\n  }\n\n  return context;\n};","map":{"version":3,"sources":["/home/jackson/www/github/simulador_plm/src/context/files.tsx"],"names":["React","useState","createContext","useEffect","useCallback","useContext","axios","v4","uuidv4","filesize","FileContext","FileProvider","children","uploadedFiles","setUploadedFiles","get","then","response","postFormatted","push","id","data","_id","name","readableSize","size","uploaded","preview","url","file","error","updateFile","state","map","processUpload","uploadedFile","FormData","append","post","headers","onUploadProgress","progressEvent","progress","Math","round","loaded","total","console","log","catch","err","handleUpload","files","newUploadedFiles","concat","forEach","deleteFile","delete","filter","useFiles","context","Error"],"mappings":"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","sourcesContent":["import React, {\n\tuseState,\n\tcreateContext,\n\tuseEffect,\n\tuseCallback,\n\tuseContext\n} from 'react'\nimport axios from 'axios'\nimport Image from 'next/image'\nimport { v4 as uuidv4 } from 'uuid'\nimport filesize from 'filesize'\n\nexport interface IImage {\n\t_id: string\n\tname: string\n\tsize: number\n\tkey: string\n\turl: string\n}\n\nexport interface IFile {\n\tid: string\n\tname: string\n\treadableSize: string\n\tuploaded?: boolean\n\tpreview: string\n\tfile: File | null\n\tprogress?: number\n\terror?: boolean\n\turl: string\n}\n\ninterface IFileContextData {\n\tuploadedFiles: IFile[]\n\tdeleteFile(id: string): void\n\thandleUpload(file: any): void\n}\n\nconst FileContext = createContext<IFileContextData>({} as IFileContextData)\n\nexport const FileProvider: React.FC = ({ children }) => {\n\tconst [uploadedFiles, setUploadedFiles] = useState<IFile[]>([])\n\n\tuseEffect(() => {\n\t\taxios.get('/api/upload/').then(response => {\n\t\t\tconst postFormatted: IFile[] = []\n\t\t\tpostFormatted.push({\n\t\t\t\tid: response.data._id,\n\t\t\t\tname: response.data.name,\n\t\t\t\treadableSize: filesize(response.data.size),\n\t\t\t\tuploaded: true,\n\t\t\t\tpreview: response.data.url,\n\t\t\t\tfile: null,\n\t\t\t\terror: false,\n\t\t\t\turl: response.data.url\n\t\t\t})\n\n\t\t\tsetUploadedFiles(postFormatted)\n\t\t})\n\t}, [])\n\n\tconst updateFile = useCallback((id, data) => {\n\t\tsetUploadedFiles(state =>\n\t\t\tstate.map(file => (file.id === id ? { ...file, ...data } : file))\n\t\t)\n\t}, [])\n\n\tconst processUpload = useCallback(\n\t\t(uploadedFile: IFile) => {\n\t\t\tconst data = new FormData()\n\t\t\tif (uploadedFile.file) {\n\t\t\t\tdata.append('image', uploadedFile.file, uploadedFile.name)\n\n\t\t\t\taxios\n\t\t\t\t\t.post('/api/upload/', data, {\n\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t'content-type': 'multipart/form-data'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonUploadProgress: progressEvent => {\n\t\t\t\t\t\t\tconst progress: number = Math.round(\n\t\t\t\t\t\t\t\t(progressEvent.loaded * 100) / progressEvent.total\n\t\t\t\t\t\t\t)\n\n\t\t\t\t\t\t\tconsole.log(\n\t\t\t\t\t\t\t\t`A imagem ${uploadedFile.name} está ${progress}% carregada... `\n\t\t\t\t\t\t\t)\n\n\t\t\t\t\t\t\tupdateFile(uploadedFile.id, { progress })\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.then(response => {\n\t\t\t\t\t\tconsole.log(\n\t\t\t\t\t\t\t`A imagem ${uploadedFile.name} já foi enviada para o servidor!`\n\t\t\t\t\t\t)\n\n\t\t\t\t\t\tupdateFile(uploadedFile.id, {\n\t\t\t\t\t\t\tuploaded: true,\n\t\t\t\t\t\t\tid: uploadedFile.id,\n\t\t\t\t\t\t\tpreview: response.data.url,\n\t\t\t\t\t\t\turl: response.data.url\n\t\t\t\t\t\t})\n\t\t\t\t\t})\n\t\t\t\t\t.catch(err => {\n\t\t\t\t\t\tconsole.error(\n\t\t\t\t\t\t\t`Houve um problema para fazer upload da imagem ${uploadedFile.name}`\n\t\t\t\t\t\t)\n\t\t\t\t\t\tconsole.log(err)\n\n\t\t\t\t\t\tupdateFile(uploadedFile.id, {\n\t\t\t\t\t\t\terror: true\n\t\t\t\t\t\t})\n\t\t\t\t\t})\n\t\t\t}\n\t\t},\n\t\t[updateFile]\n\t)\n\n\tconst handleUpload = useCallback(\n\t\t(files: File[]) => {\n\t\t\tconst newUploadedFiles: IFile[] = files.map((file: File) => ({\n\t\t\t\tfile,\n\t\t\t\tid: uuidv4(),\n\t\t\t\tname: file.name,\n\t\t\t\treadableSize: filesize(file.size),\n\t\t\t\tpreview: `/uploads/${file.name}`,\n\t\t\t\tprogress: 0,\n\t\t\t\tuploaded: false,\n\t\t\t\terror: false,\n\t\t\t\turl: `/uploads/${file.name}`\n\t\t\t}))\n\n\t\t\tsetUploadedFiles(state => state.concat(newUploadedFiles))\n\t\t\tnewUploadedFiles.forEach(processUpload)\n\t\t},\n\t\t[processUpload]\n\t)\n\n\tconst deleteFile = useCallback((name: string) => {\n\t\taxios.delete(`api/upload/?fileName=${name}`)\n\t\tsetUploadedFiles(state => state.filter(file => file.name !== name))\n\t}, [])\n\n\treturn (\n\t\t<FileContext.Provider value={{ uploadedFiles, deleteFile, handleUpload }}>\n\t\t\t{children}\n\t\t</FileContext.Provider>\n\t)\n}\n\nexport const useFiles = (): IFileContextData => {\n\tconst context = useContext(FileContext)\n\n\tif (!context) {\n\t\tthrow new Error('useFiles must be used within FileProvider')\n\t}\n\n\treturn context\n}\n"]},"metadata":{},"sourceType":"module"}